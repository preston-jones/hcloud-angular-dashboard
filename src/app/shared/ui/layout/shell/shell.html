<div class="h-screen w-full flex flex-col">
  <!-- Global Header - spans full width -->
  <app-topbar (search)="onSearch($event)"></app-topbar>

  <!-- Content Area with Sidebar -->
  <div class="flex-1 relative overflow-hidden">
    <app-sidebar 
      [collapsed]="collapsed()" 
      [isPinned]="isPinned()"
      (mouseenter)="expandSidebar()" 
      (mouseleave)="collapseSidebar()"
      (togglePin)="togglePin()">
    </app-sidebar>
    
    <!-- Page Header - adapts to sidebar state -->
    @if (pageHeaderService.header()) {
      <div class="page-header bg-card border-b border-ui transition-all duration-300"
           [style.margin-left]="getSidebarWidth()">
        @if (pageHeaderService.header()?.template) {
          <ng-container 
            [ngTemplateOutlet]="pageHeaderService.header()!.template!" 
            [ngTemplateOutletContext]="pageHeaderService.header()!.context">
          </ng-container>
        } @else {
          <div class="px-6 py-4">
            @if (pageHeaderService.header()?.title) {
              <h1 class="text-2xl font-bold text-ink">{{ pageHeaderService.header()!.title }}</h1>
            }
            @if (pageHeaderService.header()?.subtitle) {
              <p class="text-soft mt-1">{{ pageHeaderService.header()!.subtitle }}</p>
            }
          </div>
        }
      </div>
    }
    
    <main class="h-full p-6 overflow-auto bg-surface flex justify-center transition-all duration-300"
          [style.margin-left]="getSidebarWidth()">
      <div class="w-full max-w-[1440px]">
        <router-outlet></router-outlet>
      </div>
    </main>
  </div>

  <!-- Demo Restriction Dialog -->
  @if (api.showDemoRestrictionDialog()) {
  <app-demo-restriction-dialog (close)="api.closeDemoRestrictionDialog()"></app-demo-restriction-dialog>
  }
</div>