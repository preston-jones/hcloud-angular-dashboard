<section class="section">
  <div class="section-header">
    <h1 class="section-title">Server erstellen</h1>
    <p class="section-description">Erstellen Sie einen neuen Cloud-Server mit dem Server-Assistenten</p>
  </div>

  <!-- Main Wizard Layout -->
  <div class="wizard-layout">
    <!-- Left Side: Scrollable Wizard Steps -->
    <div class="wizard-main">
      
      <!-- Wizard Progress -->
      <div class="wizard-progress">
        <div class="progress-steps">
          <div class="progress-step" [class.active]="currentStep() === 'architecture'" [class.completed]="isStepCompleted('architecture')">
            <div class="step-number">1</div>
            <div class="step-label">Architektur</div>
          </div>
          <div class="progress-step" [class.active]="currentStep() === 'location'" [class.completed]="isStepCompleted('location')">
            <div class="step-number">2</div>
            <div class="step-label">Standort</div>
          </div>
          <div class="progress-step" [class.active]="currentStep() === 'image'" [class.completed]="isStepCompleted('image')">
            <div class="step-number">3</div>
            <div class="step-label">Image</div>
          </div>
          <div class="progress-step" [class.active]="currentStep() === 'type'" [class.completed]="isStepCompleted('type')">
            <div class="step-number">4</div>
            <div class="step-label">Server-Typ</div>
          </div>
          <div class="progress-step" [class.active]="currentStep() === 'summary'" [class.completed]="isStepCompleted('summary')">
            <div class="step-number">5</div>
            <div class="step-label">Zusammenfassung</div>
          </div>
        </div>
      </div>

      <!-- Scrollable Steps Container -->
      <div class="wizard-steps-container">
        
        <!-- Step 1: Architecture Selection -->
        <div class="wizard-step" id="step-architecture">
          <div class="step-header">
            <h2 class="step-title">1. Architektur wÃ¤hlen</h2>
            <p class="step-description">WÃ¤hlen Sie die gewÃ¼nschte Server-Architektur</p>
          </div>

          <div class="architecture-options">
            <!-- All Architecture Cards in One Row -->
            <div class="architecture-cards-row">
              <div class="architecture-option" 
                   [class.selected]="selectedArchitecture() === 'cost-optimized'"
                   (click)="selectArchitecture('cost-optimized')">
                <div class="option-header">
                  <h4>Cost-Optimized</h4>
                  <span class="availability-badge limited">Limitierte VerfÃ¼gbarkeit</span>
                </div>
                <p>Ideal fÃ¼r Entwicklung und Tests</p>
                <div class="arch-category-label">Shared Resources</div>
                
                <!-- Architecture Selection for Cost-Optimized -->
                <div class="arch-selection">
                  <div class="arch-option" 
                       [class.selected]="selectedCpuArchitecture() === 'x86'"
                       (click)="selectCpuArchitecture('x86')">
                    <input type="radio" name="cost-optimized-arch" value="x86" [checked]="selectedCpuArchitecture() === 'x86'">
                    <span>x86 (Intel/AMD)</span>
                  </div>
                  <div class="arch-option"
                       [class.selected]="selectedCpuArchitecture() === 'arm64'"
                       (click)="selectCpuArchitecture('arm64')">
                    <input type="radio" name="cost-optimized-arch" value="arm64" [checked]="selectedCpuArchitecture() === 'arm64'">
                    <span>Arm64 (Ampere)</span>
                  </div>
                </div>
              </div>
              
              <div class="architecture-option" 
                   [class.selected]="selectedArchitecture() === 'regular-performance'"
                   (click)="selectArchitecture('regular-performance')">
                <div class="option-header">
                  <h4>Regular Performance</h4>
                </div>
                <p>Ausgewogene Performance fÃ¼r die meisten Anwendungen</p>
                <div class="arch-category-label">Shared Resources</div>
                
                <!-- Architecture Selection for Regular Performance -->
                <div class="arch-selection">
                  <div class="arch-option"
                       [class.selected]="selectedCpuArchitecture() === 'x86'"
                       (click)="selectCpuArchitecture('x86')">
                    <input type="radio" name="regular-performance-arch" value="x86" [checked]="selectedCpuArchitecture() === 'x86'">
                    <span>x86 (AMD)</span>
                  </div>
                </div>
              </div>

              <div class="architecture-option" 
                   [class.selected]="selectedArchitecture() === 'general-purpose'"
                   (click)="selectArchitecture('general-purpose')">
                <div class="option-header">
                  <h4>General Purpose</h4>
                </div>
                <p>Dedizierte CPU-Performance fÃ¼r produktive Workloads</p>
                <div class="arch-category-label">Dedicated Resources</div>
                
                <!-- Architecture Selection for General Purpose -->
                <div class="arch-selection">
                  <div class="arch-option"
                       [class.selected]="selectedCpuArchitecture() === 'x86'"
                       (click)="selectCpuArchitecture('x86')">
                    <input type="radio" name="general-purpose-arch" value="x86" [checked]="selectedCpuArchitecture() === 'x86'">
                    <span>x86 (AMD)</span>
                  </div>
                </div>
              </div>
            </div>
          </div>

          <!-- Server Types Table under Architecture -->
          @if (selectedArchitecture()) {
          <div class="server-types-section">
            <h3>VerfÃ¼gbare Server-Typen</h3>
            <div class="server-type-table">
              <div class="table-header">
                <div class="col-name">Name</div>
                <div class="col-vcpus">vCPUs</div>
                <div class="col-memory">RAM</div>
                <div class="col-disk">Disk</div>
                <div class="col-transfer">Transfer</div>
                <div class="col-price">Preis/Monat</div>
              </div>

              @for (server of filteredServers(); track server.id; let i = $index) {
                @if (i < 6) {
                <div class="table-row" 
                     [class.selected]="selectedServerType() === server.server_type?.name" 
                     [class.unavailable]="isServerTypeUnavailable(server.server_type?.name || '')"
                     (click)="selectServerType(server.server_type?.name || '')">
                  <div class="col-name">
                    <strong>{{ server.server_type?.name || 'Unknown' }}</strong>
                    @if (isServerTypeUnavailable(server.server_type?.name || '')) {
                    <span class="unavailable-badge">Ausverkauft</span>
                    }
                  </div>
                  <div class="col-vcpus">{{ server.server_type?.cores || 0 }}</div>
                  <div class="col-memory">{{ server.server_type?.memory || 0 }} GB</div>
                  <div class="col-disk">{{ server.server_type?.disk || 0 }} GB</div>
                  <div class="col-transfer">20 TB</div>
                  <div class="col-price">â‚¬{{ server.server_type?.prices?.[0]?.price_monthly?.gross || '0.00' }}</div>
                </div>
                }
              }
            </div>
          </div>
          }
        </div>

        <!-- Step 2: Location Selection -->
        <div class="wizard-step" id="step-location">
          <div class="step-header">
            <h2 class="step-title">2. Standort wÃ¤hlen</h2>
            <p class="step-description">WÃ¤hlen Sie den Standort fÃ¼r Ihren Server</p>
          </div>

          <div class="location-grid">
            <div class="location-card" 
                 [class.selected]="selectedLocation() === 'fsn1'"
                 (click)="selectLocation('fsn1')">
              <div class="location-flag">ðŸ‡©ðŸ‡ª</div>
              <div class="location-info">
                <h4>Falkenstein</h4>
                <span class="location-code">fsn1</span>
              </div>
              <div class="location-badge">Deutschland</div>
            </div>

            <div class="location-card" 
                 [class.selected]="selectedLocation() === 'nbg1'"
                 (click)="selectLocation('nbg1')">
              <div class="location-flag">ðŸ‡©ðŸ‡ª</div>
              <div class="location-info">
                <h4>NÃ¼rnberg</h4>
                <span class="location-code">nbg1</span>
              </div>
              <div class="location-badge">Deutschland</div>
            </div>

            <div class="location-card" 
                 [class.selected]="selectedLocation() === 'hel1'"
                 (click)="selectLocation('hel1')">
              <div class="location-flag">ðŸ‡«ðŸ‡®</div>
              <div class="location-info">
                <h4>Helsinki</h4>
                <span class="location-code">hel1</span>
              </div>
              <div class="location-badge">Finnland</div>
            </div>

            <div class="location-card" 
                 [class.selected]="selectedLocation() === 'ash'"
                 (click)="selectLocation('ash')">
              <div class="location-flag">ðŸ‡ºðŸ‡¸</div>
              <div class="location-info">
                <h4>Ashburn</h4>
                <span class="location-code">ash</span>
              </div>
              <div class="location-badge">USA</div>
            </div>

            <div class="location-card" 
                 [class.selected]="selectedLocation() === 'hil'"
                 (click)="selectLocation('hil')">
              <div class="location-flag">ðŸ‡ºðŸ‡¸</div>
              <div class="location-info">
                <h4>Hillsboro</h4>
                <span class="location-code">hil</span>
              </div>
              <div class="location-badge">USA</div>
            </div>

            <div class="location-card" 
                 [class.selected]="selectedLocation() === 'sin'"
                 (click)="selectLocation('sin')">
              <div class="location-flag">ðŸ‡¸ðŸ‡¬</div>
              <div class="location-info">
                <h4>Singapur</h4>
                <span class="location-code">sin</span>
              </div>
              <div class="location-badge">Singapur</div>
            </div>
          </div>
        </div>

        <!-- Step 3: Image Selection -->
        <div class="wizard-step" id="step-image">
          <div class="step-header">
            <h2 class="step-title">3. Image wÃ¤hlen</h2>
            <p class="step-description">WÃ¤hlen Sie ein Betriebssystem oder eine Anwendung</p>
          </div>

          <div class="image-tabs">
            <button class="image-tab" 
                    [class.active]="activeImageTab() === 'os'"
                    (click)="setImageTab('os')">OS Images</button>
            <button class="image-tab" 
                    [class.active]="activeImageTab() === 'apps'"
                    (click)="setImageTab('apps')">Apps</button>
          </div>

          @if (activeImageTab() === 'os') {
          <div class="image-grid">
            <div class="image-card" 
                 [class.selected]="selectedImage() === 'ubuntu'"
                 (click)="selectImage('ubuntu')">
              <div class="image-icon">
                <img src="/assets/mock/ubuntu-icon.svg" alt="Ubuntu">
              </div>
              <div class="image-info">
                <h4>Ubuntu</h4>
                <p>Ubuntu 22.04 LTS</p>
              </div>
            </div>

            <div class="image-card" 
                 [class.selected]="selectedImage() === 'fedora'"
                 (click)="selectImage('fedora')">
              <div class="image-icon">
                <img src="/assets/mock/fedora-icon.svg" alt="Fedora">
              </div>
              <div class="image-info">
                <h4>Fedora</h4>
                <p>Fedora 38</p>
              </div>
            </div>

            <div class="image-card" 
                 [class.selected]="selectedImage() === 'debian'"
                 (click)="selectImage('debian')">
              <div class="image-icon">
                <img src="/assets/mock/debian-icon.svg" alt="Debian">
              </div>
              <div class="image-info">
                <h4>Debian</h4>
                <p>Debian 12</p>
              </div>
            </div>

            <div class="image-card" 
                 [class.selected]="selectedImage() === 'centos'"
                 (click)="selectImage('centos')">
              <div class="image-icon">
                <img src="/assets/mock/centos-icon.svg" alt="CentOS">
              </div>
              <div class="image-info">
                <h4>CentOS</h4>
                <p>CentOS Stream 9</p>
              </div>
            </div>
          </div>
          }

          @if (activeImageTab() === 'apps') {
          <div class="image-grid">
            <div class="image-card"
                 [class.selected]="selectedImage() === 'docker'"
                 (click)="selectImage('docker')">
              <div class="image-icon">
                <img src="/assets/mock/docker-icon.svg" alt="Docker">
              </div>
              <div class="image-info">
                <h4>Docker</h4>
                <p>Docker auf Ubuntu 22.04</p>
              </div>
            </div>
          </div>
          }
        </div>

        <!-- Step 4: Final Configuration -->
        <div class="wizard-step" id="step-configuration">
          <div class="step-header">
            <h2 class="step-title">4. Konfiguration</h2>
            <p class="step-description">ZusÃ¤tzliche Einstellungen fÃ¼r Ihren Server</p>
          </div>

          <div class="configuration-options">
            <div class="config-section">
              <h4>SSH-SchlÃ¼ssel (Optional)</h4>
              <p>FÃ¼gen Sie SSH-SchlÃ¼ssel fÃ¼r sicheren Zugang hinzu</p>
              <button class="btn btn-outline">SSH-SchlÃ¼ssel hinzufÃ¼gen</button>
            </div>

            <div class="config-section">
              <h4>Backups</h4>
              <label class="checkbox-label">
                <input type="checkbox" [checked]="enableBackups()" (change)="toggleBackups()">
                <span>Automatische Backups aktivieren (+20% der Server-Kosten)</span>
              </label>
            </div>

            <div class="config-section">
              <h4>Ãœberwachung</h4>
              <label class="checkbox-label">
                <input type="checkbox" [checked]="enableMonitoring()" (change)="toggleMonitoring()">
                <span>Server-Ãœberwachung aktivieren (kostenlos)</span>
              </label>
            </div>
          </div>
        </div>

        <!-- Action Buttons -->
        <div class="wizard-actions">
          <button class="btn btn-secondary" (click)="resetWizard()">Abbrechen</button>
          <button class="btn btn-primary" 
                  [disabled]="!canCreateServer()"
                  (click)="createServer()">Server erstellen</button>
        </div>

      </div>
    </div>

    <!-- Right Side: Summary Card -->
    <div class="wizard-sidebar">
      <div class="summary-card">
        <h3>Zusammenfassung</h3>
        
        <div class="summary-sections">
          <div class="summary-section">
            <div class="summary-label">Architektur</div>
            <div class="summary-value">
              @if (selectedArchitecture()) {
                {{ getArchitectureDisplayName() }}
              } @else {
                <span class="text-muted">Nicht ausgewÃ¤hlt</span>
              }
            </div>
          </div>

          <div class="summary-section">
            <div class="summary-label">Standort</div>
            <div class="summary-value">
              @if (selectedLocation()) {
                {{ getLocationDisplayName() }}
              } @else {
                <span class="text-muted">Nicht ausgewÃ¤hlt</span>
              }
            </div>
          </div>

          <div class="summary-section">
            <div class="summary-label">Image</div>
            <div class="summary-value">
              @if (selectedImage()) {
                {{ getImageDisplayName() }}
              } @else {
                <span class="text-muted">Nicht ausgewÃ¤hlt</span>
              }
            </div>
          </div>

          <div class="summary-section">
            <div class="summary-label">Server-Typ</div>
            <div class="summary-value">
              @if (selectedServerType()) {
                {{ selectedServerType() }}
              } @else {
                <span class="text-muted">Nicht ausgewÃ¤hlt</span>
              }
            </div>
          </div>

          @if (selectedServerType()) {
          <div class="summary-section">
            <div class="summary-label">Spezifikationen</div>
            <div class="summary-specs">
              <div>{{ getSelectedServerSpecs().vcpus }} vCPUs</div>
              <div>{{ getSelectedServerSpecs().memory }} GB RAM</div>
              <div>{{ getSelectedServerSpecs().disk }} GB Disk</div>
            </div>
          </div>
          }
        </div>

        <div class="summary-divider"></div>

        <div class="summary-pricing">
          <div class="pricing-row">
            <span>Server</span>
            <span>â‚¬{{ getServerPrice() }}/Monat</span>
          </div>
          
          @if (enableBackups()) {
          <div class="pricing-row">
            <span>Backups</span>
            <span>â‚¬{{ getBackupPrice() }}/Monat</span>
          </div>
          }

          <div class="pricing-total">
            <span>Gesamt</span>
            <span class="total-price">â‚¬{{ getTotalPrice() }}/Monat</span>
          </div>
        </div>

        <div class="summary-actions">
          @if (canCreateServer()) {
          <button class="btn btn-primary btn-full" (click)="createServer()">
            Server fÃ¼r â‚¬{{ getTotalPrice() }}/Monat erstellen
          </button>
          } @else {
          <div class="creation-hint">
            <p>WÃ¤hlen Sie Architektur, Standort und Image aus, um fortzufahren.</p>
          </div>
          }
        </div>
      </div>
    </div>
  </div>

  <!-- Server Name Dialog -->
  @if (showNameDialog()) {
  <app-server-name-dialog (confirm)="onServerNameConfirmedWizard($event)" (cancel)="showNameDialog.set(false)" />
  }
</section>