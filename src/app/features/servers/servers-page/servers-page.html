<section class="space-y-4">
  <!-- Toolbar -->
  <header class="flex flex-col gap-3 md:flex-row md:items-center md:justify-between">
    <h1 class="text-xl font-semibold text-ink">Servers</h1>

    <div class="flex flex-wrap gap-2 items-center">
      <input
        class="rounded-lg border border-ui bg-surface-elev text-ink px-3 py-2 w-64"
        placeholder="Search servers..."
        (input)="onSearchInput($event)" />

      <select
        class="rounded-lg border border-ui bg-surface-elev text-ink px-3 py-2"
        (change)="onStatusChange($event)">
        <option value="all">All status</option>
        <option value="running">Running</option>
        <option value="stopped">Stopped</option>
      </select>

      <button class="px-4 py-2 rounded-lg text-white bg-primary hover:bg-primary-700 transition-colors">
        Add Server
      </button>
    </div>
  </header>

  <!-- SKELETON (Table-Form) -->
  @if (loading()) {
    <div class="card p-0 overflow-hidden">
      <div class="px-4 py-3 bg-[color-mix(in_oklab,_var(--surface)_92%,_black)] border-b border-ui/30">
        <div class="skeleton h-5 w-40"></div>
      </div>
      <ul class="divide-y divide-[color-mix(in_oklab,_var(--border)_80%,_transparent)]">
        @for (_ of skeletonRows; track $index) {
          <li class="px-4 py-3 grid grid-cols-[2fr_1fr_0.5fr_0.5fr_0.5fr_1fr_1fr_1fr] gap-4">
            <div class="skeleton h-5 w-3/4"></div>
            <div class="skeleton h-5 w-1/2"></div>
            <div class="skeleton h-5 w-full"></div>
            <div class="skeleton h-5 w-full"></div>
            <div class="skeleton h-5 w-full"></div>
            <div class="skeleton h-5 w-2/3"></div>
            <div class="skeleton h-5 w-1/2"></div>
            <div class="skeleton h-5 w-1/2 justify-self-end"></div>
          </li>
        }
      </ul>
    </div>
  }

  <!-- TABLE (md+) -->
  @if (!loading()) {
    <div class="card p-0 overflow-hidden hidden md:block">
      <table class="w-full border-separate border-spacing-0 text-sm">
        <thead class="bg-[color-mix(in_oklab,_var(--surface)_92%,_black)] text-soft">
          <tr>
            <th class="text-left font-normal py-3 px-4">Name</th>
            <th class="text-left font-normal py-3 px-4">Type</th>
            <th class="text-left font-normal py-3 px-2 text-xs">vCPUs</th>
            <th class="text-left font-normal py-3 px-2 text-xs">RAM</th>
            <th class="text-left font-normal py-3 px-2 text-xs">SSD</th>
            <th class="text-left font-normal py-3 px-4">Location</th>
            <th class="text-left font-normal py-3 px-4">Status</th>
            <th class="text-right font-normal py-3 px-4">Price</th>
          </tr>
        </thead>
        <tbody>
          @for (s of view(); track trackRow($index, s)) {
            <tr class="group hover:bg-[color-mix(in_oklab,_var(--surface-elev)_95%,_black)] transition-colors border-b border-ui/30">
              <td class="py-3 px-4 font-medium text-primary">{{ s.name }}</td>
              <td class="py-3 px-4 text-soft">{{ s.type }}</td>
              <td class="py-3 px-2 text-soft text-xs">{{ getCpuCount(s) }}</td>
              <td class="py-3 px-2 text-soft text-xs">{{ getRamSize(s) }}</td>
              <td class="py-3 px-2 text-soft text-xs">{{ getDiskSize(s) }}</td>
              <td class="py-3 px-4 text-soft">
                @if (hasCountryData(s)) {
                  <span class="inline-flex items-center gap-2">
                    <span class="text-base">{{ getCountryFlag(s) }}</span>
                    <span>{{ getCleanCityName(s) }}</span>
                  </span>
                } @else {
                  <span>{{ getCleanCityName(s) }}</span>
                }
              </td>
              <td class="py-3 px-4">
                <span class="inline-flex items-center gap-2">
                  <span class="status-dot" [ngClass]="s.status"></span>
                  <span class="capitalize">{{ s.status }}</span>
                </span>
              </td>
              <td class="py-3 px-4 text-right text-soft">
                €{{ s.priceEur.toFixed(2) }}/mo
              </td>
            </tr>
          }
        </tbody>
      </table>
    </div>
  }

  <!-- CARD-FALLBACK (sm) -->
  @if (!loading()) {
    <div class="md:hidden space-y-2">
      @for (s of view(); track trackRow($index, s)) {
        <div class="server-card">
          <div class="flex items-center justify-between">
            <div class="name">{{ s.name }}</div>
            <div class="status-dot" [ngClass]="s.status"></div>
          </div>
          <div class="meta">
            @if (hasCountryData(s)) {
              {{ s.type }} • {{ getCountryFlag(s) }} {{ getCleanCityName(s) }} • €{{ s.priceEur.toFixed(2) }}/mo
            } @else {
              {{ s.type }} • {{ getCleanCityName(s) }} • €{{ s.priceEur.toFixed(2) }}/mo
            }
          </div>
          <div class="hardware text-xs text-soft mt-1">
            {{ getHardwareSpecs(s) }}
          </div>
        </div>
      }
    </div>
  }
</section>
