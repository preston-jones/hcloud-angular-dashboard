<section class="space-y-4">
  <!-- Toolbar -->
  <header class="flex flex-col gap-3 md:flex-row md:items-center md:justify-between">
    <h1 class="text-xl font-semibold text-ink">Servers</h1>

    <div class="flex flex-wrap gap-2 items-center">
      <select
        class="rounded-lg border border-ui bg-surface-elev text-ink px-3 py-2"
        (change)="onStatusChange($event)">
        <option value="all">All status</option>
        <option value="running">Running</option>
        <option value="stopped">Stopped</option>
      </select>

      <button class="px-4 py-2 rounded-lg text-white bg-primary hover:bg-primary-700 transition-colors">
        Add Server
      </button>
    </div>
  </header>

  <!-- SKELETON (Table with card rows) -->
  @if (loading()) {
    <div class="hidden md:block space-y-4">
      <!-- Skeleton Header -->
      <div class="bg-[color-mix(in_oklab,_var(--surface)_92%,_black)] rounded-lg border border-ui/30 px-4 py-3">
        <div class="grid grid-cols-[2fr_1fr_0.5fr_0.5fr_0.5fr_1fr_1fr_1fr] gap-4">
          <div class="skeleton h-4 w-12"></div>
          <div class="skeleton h-4 w-10"></div>
          <div class="skeleton h-4 w-8"></div>
          <div class="skeleton h-4 w-8"></div>
          <div class="skeleton h-4 w-8"></div>
          <div class="skeleton h-4 w-16"></div>
          <div class="skeleton h-4 w-12"></div>
          <div class="skeleton h-4 w-12"></div>
        </div>
      </div>

      <!-- Skeleton Rows -->
      <div class="space-y-3">
        @for (_ of skeletonRows; track $index) {
          <div class="server-card">
            <div class="grid grid-cols-[2fr_1fr_0.5fr_0.5fr_0.5fr_1fr_1fr_1fr] gap-4 items-center">
              <div class="skeleton h-5 w-3/4"></div>
              <div class="skeleton h-5 w-1/2"></div>
              <div class="skeleton h-5 w-full"></div>
              <div class="skeleton h-5 w-full"></div>
              <div class="skeleton h-5 w-full"></div>
              <div class="skeleton h-5 w-2/3"></div>
              <div class="skeleton h-5 w-1/2"></div>
              <div class="skeleton h-5 w-1/2"></div>
            </div>
          </div>
        }
      </div>
    </div>

    <!-- Mobile Skeleton -->
    <div class="md:hidden space-y-3">
      @for (_ of skeletonRows; track $index) {
        <div class="server-card">
          <div class="flex items-center justify-between mb-2">
            <div class="skeleton h-5 w-32"></div>
            <div class="skeleton h-3 w-3 rounded-full"></div>
          </div>
          <div class="skeleton h-4 w-full"></div>
          <div class="skeleton h-3 w-3/4 mt-1"></div>
        </div>
      }
    </div>
  }

  <!-- ERROR STATE -->
  @if (!loading() && error()) {
    <div class="text-center py-12">
      <div class="text-red-500 text-4xl mb-4">‚ö†Ô∏è</div>
      <h2 class="text-lg font-medium text-ink mb-2">Failed to load servers</h2>
      <p class="text-soft mb-4">{{ error() }}</p>
      <button 
        class="px-4 py-2 rounded-lg text-white bg-primary hover:bg-primary-700 transition-colors"
        (click)="retry()">
        Retry
      </button>
    </div>
  }

  <!-- EMPTY STATE -->
  @if (!loading() && !error() && view().length === 0) {
    <div class="text-center py-12">
      <div class="text-4xl mb-4">üñ•Ô∏è</div>
      <h2 class="text-lg font-medium text-ink mb-2">No servers found</h2>
      <p class="text-soft mb-6">
        @if (isUsingMockData) {
          You're using mock data and no servers are available.
        } @else {
          You don't have any servers in your Hetzner Cloud project yet.
        }
      </p>
      <div class="flex flex-col sm:flex-row gap-3 justify-center">
        <button class="px-4 py-2 rounded-lg text-white bg-primary hover:bg-primary-700 transition-colors">
          Create Server
        </button>
        @if (!isUsingMockData) {
          <a 
            href="https://console.hetzner.cloud/" 
            target="_blank"
            class="px-4 py-2 rounded-lg border border-slate-300 bg-white dark:bg-slate-700 text-slate-700 dark:text-slate-200 hover:bg-slate-50 dark:hover:bg-slate-600 transition-colors">
            Open Hetzner Console
          </a>
        }
      </div>
    </div>
  }

  <!-- TABLE WITH CARD ROWS (md+) -->
  @if (!loading() && !error() && view().length > 0) {
    <div class="hidden md:block space-y-4">
      <!-- Table Header -->
      <div class="px-4 py-3">
        <div class="grid grid-cols-[2fr_1fr_0.5fr_0.5fr_0.5fr_1fr_1fr_1fr] gap-4 text-sm text-soft font-bold">
          <button 
            class="sortable-header text-left"
            [class.sorted]="isColumnSorted('name')"
            (click)="onSort('name')"
            [attr.aria-label]="'Sort by name ' + (sortColumn() === 'name' ? sortDirection() : 'none')"
            type="button">
            <span>Name</span>
            <span class="sort-arrow" aria-hidden="true">{{ getSortIndicator('name') }}</span>
          </button>
          <button 
            class="sortable-header text-left"
            [class.sorted]="isColumnSorted('type')"
            (click)="onSort('type')"
            [attr.aria-label]="'Sort by type ' + (sortColumn() === 'type' ? sortDirection() : 'none')"
            type="button">
            <span>Type</span>
            <span class="sort-arrow" aria-hidden="true">{{ getSortIndicator('type') }}</span>
          </button>
          <button 
            class="sortable-header text-left text-xs"
            [class.sorted]="isColumnSorted('vcpus')"
            (click)="onSort('vcpus')"
            [attr.aria-label]="'Sort by vCPUs ' + (sortColumn() === 'vcpus' ? sortDirection() : 'none')"
            type="button">
            <span>vCPUs</span>
            <span class="sort-arrow" aria-hidden="true">{{ getSortIndicator('vcpus') }}</span>
          </button>
          <button 
            class="sortable-header text-left text-xs"
            [class.sorted]="isColumnSorted('ram')"
            (click)="onSort('ram')"
            [attr.aria-label]="'Sort by RAM ' + (sortColumn() === 'ram' ? sortDirection() : 'none')"
            type="button">
            <span>RAM</span>
            <span class="sort-arrow" aria-hidden="true">{{ getSortIndicator('ram') }}</span>
          </button>
          <button 
            class="sortable-header text-left text-xs"
            [class.sorted]="isColumnSorted('ssd')"
            (click)="onSort('ssd')"
            [attr.aria-label]="'Sort by SSD storage ' + (sortColumn() === 'ssd' ? sortDirection() : 'none')"
            type="button">
            <span>SSD</span>
            <span class="sort-arrow" aria-hidden="true">{{ getSortIndicator('ssd') }}</span>
          </button>
          <button 
            class="sortable-header text-left"
            [class.sorted]="isColumnSorted('location')"
            (click)="onSort('location')"
            [attr.aria-label]="'Sort by location ' + (sortColumn() === 'location' ? sortDirection() : 'none')"
            type="button">
            <span>Location</span>
            <span class="sort-arrow" aria-hidden="true">{{ getSortIndicator('location') }}</span>
          </button>
          <button 
            class="sortable-header text-left"
            [class.sorted]="isColumnSorted('status')"
            (click)="onSort('status')"
            [attr.aria-label]="'Sort by status ' + (sortColumn() === 'status' ? sortDirection() : 'none')"
            type="button">
            <span>Status</span>
            <span class="sort-arrow" aria-hidden="true">{{ getSortIndicator('status') }}</span>
          </button>
          <button 
            class="sortable-header text-right"
            [class.sorted]="isColumnSorted('price')"
            (click)="onSort('price')"
            [attr.aria-label]="'Sort by price ' + (sortColumn() === 'price' ? sortDirection() : 'none')"
            type="button">
            <span>Price</span>
            <span class="sort-arrow" aria-hidden="true">{{ getSortIndicator('price') }}</span>
          </button>
        </div>
      </div>

      <!-- Table Rows as Cards -->
      <div class="space-y-3">
        @for (s of view(); track trackRow($index, s)) {
          <div class="server-card cursor-pointer" (click)="viewServerDetails(s)">
            <div class="grid grid-cols-[2fr_1fr_0.5fr_0.5fr_0.5fr_1fr_1fr_1fr] gap-4 items-center text-sm">
              <div class="font-medium text-primary">{{ s.name }}</div>
              <div class="text-soft">{{ s.type }}</div>
              <div class="text-soft text-xs">{{ getCpuCount(s) }}</div>
              <div class="text-soft text-xs">{{ getRamSize(s) }}</div>
              <div class="text-soft text-xs">{{ getDiskSize(s) }}</div>
              <div class="text-soft">
                @if (hasCountryData(s)) {
                  <span class="inline-flex items-center gap-2">
                    <span class="text-base">{{ getCountryFlag(s) }}</span>
                    <span>{{ getCleanCityName(s) }}</span>
                  </span>
                } @else {
                  <span>{{ getCleanCityName(s) }}</span>
                }
              </div>
              <div>
                <span class="inline-flex items-center gap-2">
                  <span class="status-dot" [ngClass]="s.status"></span>
                  <span class="capitalize">{{ s.status }}</span>
                </span>
              </div>
              <div class="text-right text-soft">
                ‚Ç¨{{ s.priceEur.toFixed(2) }}/mo
              </div>
            </div>
          </div>
        }
      </div>
    </div>
  }

  <!-- MOBILE CARDS (sm) -->
  @if (!loading() && !error() && view().length > 0) {
    <div class="md:hidden space-y-3">
      @for (s of view(); track trackRow($index, s)) {
        <div class="server-card" (click)="viewServerDetails(s)">
          <div class="flex items-center justify-between">
            <div class="name">{{ s.name }}</div>
            <div class="status-dot" [ngClass]="s.status"></div>
          </div>
          <div class="meta">
            @if (hasCountryData(s)) {
              {{ s.type }} ‚Ä¢ {{ getCountryFlag(s) }} {{ getCleanCityName(s) }} ‚Ä¢ ‚Ç¨{{ s.priceEur.toFixed(2) }}/mo
            } @else {
              {{ s.type }} ‚Ä¢ {{ getCleanCityName(s) }} ‚Ä¢ ‚Ç¨{{ s.priceEur.toFixed(2) }}/mo
            }
          </div>
          <div class="hardware text-xs text-soft mt-1">
            {{ getHardwareSpecs(s) }}
          </div>
        </div>
      }
    </div>
  }
</section>
