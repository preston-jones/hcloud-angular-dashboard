<section class="section">
  <!-- Main Wizard Layout -->
  <div class="wizard-layout">
    <!-- Left Side: Scrollable Wizard Steps -->
    <div class="wizard-main">
      
      <!-- Scrollable Steps Container -->
      <div class="wizard-steps-container">
        
        <!-- Step 1: Architecture Selection -->
        <div class="wizard-step" id="step-architecture">
          <div class="step-header">
            <h2 class="step-title">
              <span class="step-icon-header" [class.completed]="isStepCompleted('architecture') && selectedServerType()">
                @if (isStepCompleted('architecture') && selectedServerType()) {
                  âœ“
                } @else {
                  !
                }
              </span>
              Architecture
            </h2>
            <p class="step-description">Select the desired server architecture</p>
          </div>

          <div class="architecture-options">
            <!-- All Architecture Cards in One Row -->
            <div class="architecture-cards-row">
              <div class="architecture-option" 
                   [class.selected]="selectedArchitecture() === 'cost-optimized'"
                   (click)="selectArchitecture('cost-optimized')">
                <div class="option-header">
                  <h4>Cost-Optimized</h4>
                  <span class="availability-badge limited">Limited Availability</span>
                </div>
                <p>Ideal fÃ¼r Entwicklung und Tests</p>
                <div class="arch-category-label">Shared Resources</div>
                
                <!-- Architecture Selection for Cost-Optimized -->
                <div class="arch-selection">
                  <div class="arch-selection-header">Architecture</div>
                  <div class="arch-options">
                    <div class="arch-option" 
                         [class.selected]="selectedCpuArchitecture() === 'x86'"
                         (click)="selectCpuArchitecture('x86')">
                      <input type="radio" name="cost-optimized-arch" value="x86" [checked]="selectedCpuArchitecture() === 'x86'">
                      <span>x86 (Intel/AMD)</span>
                    </div>
                    <div class="arch-option"
                         [class.selected]="selectedCpuArchitecture() === 'arm64'"
                         (click)="selectCpuArchitecture('arm64')">
                      <input type="radio" name="cost-optimized-arch" value="arm64" [checked]="selectedCpuArchitecture() === 'arm64'">
                      <span>Arm64 (Ampere)</span>
                    </div>
                  </div>
                </div>
              </div>
              
              <div class="architecture-option" 
                   [class.selected]="selectedArchitecture() === 'regular-performance'"
                   (click)="selectArchitecture('regular-performance')">
                <div class="option-header">
                  <h4>Regular Performance</h4>
                </div>
                <p>Ausgewogene Performance fÃ¼r die meisten Anwendungen</p>
                <div class="arch-category-label">Shared Resources</div>
                
                <!-- Architecture Selection for Regular Performance -->
                <div class="arch-selection">
                  <div class="arch-selection-header">Architecture</div>
                  <div class="arch-options">
                    <div class="arch-option selected">
                      <span>x86 (AMD)</span>
                    </div>
                  </div>
                </div>
              </div>

              <div class="architecture-option" 
                   [class.selected]="selectedArchitecture() === 'general-purpose'"
                   (click)="selectArchitecture('general-purpose')">
                <div class="option-header">
                  <h4>General Purpose</h4>
                </div>
                <p>Dedizierte CPU-Performance fÃ¼r produktive Workloads</p>
                <div class="arch-category-label">Dedicated Resources</div>
                
                <!-- Architecture Selection for General Purpose -->
                <div class="arch-selection">
                  <div class="arch-selection-header">Architecture</div>
                  <div class="arch-options">
                    <div class="arch-option selected">
                      <span>x86 (AMD)</span>
                    </div>
                  </div>
                </div>
              </div>
            </div>
          </div>

          <!-- Server Types Table under Architecture -->
          @if (selectedArchitecture()) {
          <div class="server-types-section">
            <h3>Available Server Types</h3>
            <div class="server-type-table">
              <div class="table-header">
                <div class="col-name">Name</div>
                <div class="col-vcpus">vCPUs</div>
                <div class="col-memory">RAM</div>
                <div class="col-disk">Disk</div>
                <div class="col-transfer">Transfer</div>
                <div class="col-price">Preis/Monat</div>
              </div>

              @for (server of filteredServers(); track server.id; let i = $index) {
                @if (i < 6) {
                <div class="table-row" 
                     [class.selected]="selectedServerType() === server.server_type?.name" 
                     [class.unavailable]="isServerTypeUnavailable(server.server_type?.name || '')"
                     (click)="selectServerType(server.server_type?.name || '')">
                  <div class="col-name">
                    <strong>{{ server.server_type?.name || 'Unknown' }}</strong>
                    @if (isServerTypeUnavailable(server.server_type?.name || '')) {
                    <span class="unavailable-badge">Ausverkauft</span>
                    }
                  </div>
                  <div class="col-vcpus">{{ server.server_type?.cores || 0 }}</div>
                  <div class="col-memory">{{ server.server_type?.memory || 0 }} GB</div>
                  <div class="col-disk">{{ server.server_type?.disk || 0 }} GB</div>
                  <div class="col-transfer">20 TB</div>
                  <div class="col-price">â‚¬{{ server.server_type?.prices?.[0]?.price_monthly?.gross || '0.00' }}</div>
                </div>
                }
              }
            </div>
          </div>
          }
        </div>

        <!-- Step 2: Location Selection -->
        <div class="wizard-step" id="step-location">
          <div class="step-header">
            <h2 class="step-title">
              <span class="step-icon-header" [class.completed]="isStepCompleted('location')">
                @if (isStepCompleted('location')) {
                  âœ“
                } @else {
                  !
                }
              </span>
              Location
            </h2>
            <p class="step-description">Select the location for your server</p>
          </div>

          <div class="location-grid">
            <div class="location-card" 
                 [class.selected]="selectedLocation() === 'fsn1'"
                 (click)="selectLocation('fsn1')">
              <div class="location-flag">ðŸ‡©ðŸ‡ª</div>
              <div class="location-info">
                <h4>Falkenstein</h4>
              </div>
              <div class="location-badge">Germany</div>
            </div>

            <div class="location-card" 
                 [class.selected]="selectedLocation() === 'nbg1'"
                 (click)="selectLocation('nbg1')">
              <div class="location-flag">ðŸ‡©ðŸ‡ª</div>
              <div class="location-info">
                <h4>NÃ¼rnberg</h4>
              </div>
              <div class="location-badge">Germany</div>
            </div>

            <div class="location-card" 
                 [class.selected]="selectedLocation() === 'hel1'"
                 (click)="selectLocation('hel1')">
              <div class="location-flag">ðŸ‡«ðŸ‡®</div>
              <div class="location-info">
                <h4>Helsinki</h4>
              </div>
              <div class="location-badge">Finland</div>
            </div>

            <div class="location-card" 
                 [class.selected]="selectedLocation() === 'ash'"
                 (click)="selectLocation('ash')">
              <div class="location-flag">ðŸ‡ºðŸ‡¸</div>
              <div class="location-info">
                <h4>Ashburn</h4>
              </div>
              <div class="location-badge">USA</div>
            </div>

            <div class="location-card" 
                 [class.selected]="selectedLocation() === 'hil'"
                 (click)="selectLocation('hil')">
              <div class="location-flag">ðŸ‡ºðŸ‡¸</div>
              <div class="location-info">
                <h4>Hillsboro</h4>
              </div>
              <div class="location-badge">USA</div>
            </div>

            <div class="location-card" 
                 [class.selected]="selectedLocation() === 'sin'"
                 (click)="selectLocation('sin')">
              <div class="location-flag">ðŸ‡¸ðŸ‡¬</div>
              <div class="location-info">
                <h4>Singapore</h4>
              </div>
              <div class="location-badge">Singapore</div>
            </div>
          </div>
        </div>

        <!-- Step 3: Image Selection -->
        <div class="wizard-step" id="step-image">
          <div class="step-header">
            <h2 class="step-title">
              <span class="step-icon-header" [class.completed]="isStepCompleted('image')">
                @if (isStepCompleted('image')) {
                  âœ“
                } @else {
                  !
                }
              </span>
              Image
            </h2>
            <p class="step-description">Select an operating system or application</p>
          </div>

          <div class="image-tabs">
            <button class="image-tab" 
                    [class.active]="activeImageTab() === 'os'"
                    (click)="setImageTab('os')">OS Images</button>
            <button class="image-tab" 
                    [class.active]="activeImageTab() === 'apps'"
                    (click)="setImageTab('apps')">Apps</button>
          </div>

          @if (activeImageTab() === 'os') {
          <div class="image-grid">
            <div class="image-card" 
                 [class.selected]="selectedImage() === 'ubuntu'"
                 (click)="selectImage('ubuntu')">
              <div class="image-icon">
                <img src="/assets/icons/ubuntu-icon.svg" alt="Ubuntu">
              </div>
              <div class="image-info">
                <h4>Ubuntu</h4>
                <p>Ubuntu 22.04 LTS</p>
              </div>
            </div>

            <div class="image-card" 
                 [class.selected]="selectedImage() === 'fedora'"
                 (click)="selectImage('fedora')">
              <div class="image-icon">
                <img src="/assets/icons/fedora-icon.svg" alt="Fedora">
              </div>
              <div class="image-info">
                <h4>Fedora</h4>
                <p>Fedora 38</p>
              </div>
            </div>

            <div class="image-card" 
                 [class.selected]="selectedImage() === 'debian'"
                 (click)="selectImage('debian')">
              <div class="image-icon">
                <img src="/assets/icons/debian-icon.svg" alt="Debian">
              </div>
              <div class="image-info">
                <h4>Debian</h4>
                <p>Debian 12</p>
              </div>
            </div>

            <div class="image-card" 
                 [class.selected]="selectedImage() === 'centos'"
                 (click)="selectImage('centos')">
              <div class="image-icon">
                <img src="/assets/icons/centos-icon.svg" alt="CentOS">
              </div>
              <div class="image-info">
                <h4>CentOS</h4>
                <p>CentOS Stream 9</p>
              </div>
            </div>
          </div>
          }

          @if (activeImageTab() === 'apps') {
          <div class="image-grid">
            <div class="image-card"
                 [class.selected]="selectedImage() === 'docker'"
                 (click)="selectImage('docker')">
              <div class="image-icon">
                <img src="/assets/mock/docker-icon.svg" alt="Docker">
              </div>
              <div class="image-info">
                <h4>Docker</h4>
                <p>Docker auf Ubuntu 22.04</p>
              </div>
            </div>
          </div>
          }
        </div>

        <!-- Step 4: Final Configuration -->
        <div class="wizard-step" id="step-configuration">
          <div class="step-header">
            <h2 class="step-title">
              <span class="step-icon-header" [class.completed]="isStepCompleted('summary')">
                @if (isStepCompleted('summary')) {
                  âœ“
                } @else {
                  !
                }
              </span>
              Configuration (Optional)
            </h2>
            <p class="step-description">Additional settings for your server</p>
          </div>

          <div class="configuration-options">
            <div class="config-section">
              <h4>SSH Keys (Optional)</h4>
              <p>Add SSH keys for secure access</p>
              <button class="btn btn-outline">Add SSH Key</button>
            </div>

            <div class="config-section">
              <h4>Backups</h4>
              <label class="checkbox-label">
                <input type="checkbox" [checked]="enableBackups()" (change)="toggleBackups()">
                <span>Enable automatic backups (+20% of server costs)</span>
              </label>
            </div>

            <div class="config-section">
              <h4>Monitoring</h4>
              <label class="checkbox-label">
                <input type="checkbox" [checked]="enableMonitoring()" (change)="toggleMonitoring()">
                <span>Enable server monitoring (free)</span>
              </label>
            </div>
          </div>
        </div>

        <!-- Action Buttons -->
        <div class="wizard-actions">
          <button class="btn btn-secondary" (click)="resetWizard()">Abbrechen</button>
        </div>

      </div>
    </div>

    <!-- Right Side: Summary Card -->
    <div class="wizard-sidebar">
      <div class="summary-card">
        <h3>Server Configuration</h3>
        
        <div class="summary-sections">
          <div class="summary-section" [class.completed]="isStepCompleted('architecture') && selectedServerType()" [class.active]="isSectionActive('step-architecture')" (click)="scrollToStep('step-architecture')">
            <div class="progress-step" [class.active]="currentStep() === 'architecture'" [class.completed]="isStepCompleted('architecture') && selectedServerType()">
              <div class="step-icon">
                @if (isStepCompleted('architecture') && selectedServerType()) {
                  âœ“
                } @else {
                  !
                }
              </div>
            </div>
            <div class="summary-content">
              <div class="summary-value">
                @if (selectedArchitecture() && selectedServerType()) {
                  {{ selectedServerType() }}
                }
              </div>
              <div class="summary-label">Type</div>
            </div>
          </div>

          <div class="summary-section" [class.completed]="isStepCompleted('location')" [class.active]="isSectionActive('step-location')" (click)="scrollToStep('step-location')">
            <div class="progress-step" [class.active]="currentStep() === 'location'" [class.completed]="isStepCompleted('location')">
              <div class="step-icon">
                @if (isStepCompleted('location')) {
                  âœ“
                } @else {
                  !
                }
              </div>
            </div>
            <div class="summary-content">
              <div class="summary-value">
                @if (selectedLocation()) {
                  {{ getLocationDisplayName() }}
                }
              </div>
              <div class="summary-label">Location</div>
            </div>
          </div>

          <div class="summary-section" [class.completed]="isStepCompleted('image')" [class.active]="isSectionActive('step-image')" (click)="scrollToStep('step-image')">
            <div class="progress-step" [class.active]="currentStep() === 'image'" [class.completed]="isStepCompleted('image')">
              <div class="step-icon">
                @if (isStepCompleted('image')) {
                  âœ“
                } @else {
                  !
                }
              </div>
            </div>
            <div class="summary-content">
              <div class="summary-value">
                @if (selectedImage()) {
                  {{ getImageDisplayName() }}
                }
              </div>
              <div class="summary-label">Image</div>
            </div>
          </div>

          <div class="summary-section" [class.completed]="isStepCompleted('summary')" [class.active]="isSectionActive('step-configuration')" (click)="scrollToStep('step-configuration')">
            <div class="progress-step" [class.active]="currentStep() === 'summary'" [class.completed]="isStepCompleted('summary')">
              <div class="step-icon">
                @if (isStepCompleted('summary')) {
                  âœ“
                } @else {
                  !
                }
              </div>
            </div>
            <div class="summary-content">
              <div class="summary-value">
                @if (currentStep() === 'summary') {
                  <span class="text-primary">In Progress</span>
                }
              </div>
              <div class="summary-label">Configuration</div>
            </div>
          </div>

          <div class="summary-divider"></div>
          <div class="summary-section specs-section">
            <div class="summary-label">Specifications</div>
            <div class="summary-specs">
              @if (selectedServerType()) {
                <div>{{ getSelectedServerSpecs().vcpus }} vCPUs</div>
                <div>{{ getSelectedServerSpecs().memory }} GB RAM</div>
                <div>{{ getSelectedServerSpecs().disk }} GB Disk</div>
              } @else {
                <div class="text-muted">Not yet available</div>
              }
            </div>
          </div>
        </div>

        <div class="summary-divider"></div>

        <div class="summary-pricing">
          <div class="pricing-row">
            <span>Server</span>
            <span>â‚¬{{ getServerPrice() }}/Month</span>
          </div>
          
          @if (enableBackups()) {
          <div class="pricing-row">
            <span>Backups</span>
            <span>â‚¬{{ getBackupPrice() }}/Month</span>
          </div>
          }

          <div class="pricing-total">
            <span>Total</span>
            <span class="total-price">â‚¬{{ getTotalPrice() }}/Month</span>
          </div>
        </div>

        <div class="summary-actions">
          <button class="px-4 py-2 rounded-lg text-white bg-red-600 hover:bg-red-700 transition-colors w-full"
                  [disabled]="!canCreateServer()"
                  (click)="createServer()">
            Create Server
          </button>
          
          @if (!canCreateServer()) {
          <div class="creation-hint">
            <p>Select architecture, location, and image to continue.</p>
          </div>
          }
        </div>
      </div>
    </div>
  </div>

  <!-- Server Name Dialog -->
  @if (showNameDialog()) {
  <app-server-name-dialog (confirm)="onServerNameConfirmedWizard($event)" (cancel)="showNameDialog.set(false)" />
  }
</section>