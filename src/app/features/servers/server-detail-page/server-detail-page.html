<section class="space-y-6">
  <!-- Header with Navigation and Power Control -->
  <header class="flex flex-col gap-3 lg:flex-row lg:items-center lg:justify-between">
    <div class="flex items-center gap-3">
      <button 
        (click)="goBack()"
        class="rounded-lg px-3 py-2 text-soft hover:bg-[color-mix(in_oklab,_var(--text)_8%,_transparent)] transition-colors"
        aria-label="Go back to servers list">
        ‚Üê Back
      </button>
      <div class="flex-1">
        @if (server() && !loading()) {
          <h1 class="text-2xl font-bold text-ink">{{ server()!.name }}</h1>
          <div class="flex items-center gap-3 mt-1">
            <span class="text-lg font-medium text-soft">{{ server()!.server_type?.name?.toUpperCase() || 'UNKNOWN' }}</span>
            <span class="text-soft">#{{ server()!.id.toString().slice(-8) }}</span>
            <span class="inline-flex items-center gap-2">
              <span class="status-dot" [ngClass]="server()!.status"></span>
              <span class="capitalize text-soft">{{ server()!.status }}</span>
            </span>
          </div>
        } @else {
          <h1 class="text-xl font-semibold text-ink">Server Details</h1>
        }
      </div>
    </div>
    
    @if (server() && !loading()) {
      <div class="flex items-center gap-3">
        <button 
          (click)="deleteServer()"
          class="action-btn action-btn-danger">
          üóëÔ∏è Delete
        </button>
        
        <!-- Power Toggle Switch with Label -->
        <div class="power-toggle-wrapper">
          <label class="power-switch">
            <input 
              type="checkbox" 
              [checked]="server()!.status === 'running'"
              (change)="togglePower()"
              [disabled]="false">
            <span class="power-slider"></span>
          </label>
          <span class="power-label">
            {{ server()!.status === 'running' ? 'ON' : 'OFF' }}
          </span>
        </div>
      </div>
    }
  </header>

  <!-- Loading State -->
  @if (loading()) {
    <div class="server-detail-card">
      <div class="space-y-4">
        <div class="skeleton h-6 w-48"></div>
        <div class="skeleton h-4 w-32"></div>
        <div class="skeleton h-4 w-24"></div>
        <div class="grid grid-cols-1 md:grid-cols-3 gap-4 mt-6">
          <div class="skeleton h-20 w-full"></div>
          <div class="skeleton h-20 w-full"></div>
          <div class="skeleton h-20 w-full"></div>
        </div>
      </div>
    </div>
  }

  <!-- Error State -->
  @if (error() && !loading()) {
    <div class="server-detail-card">
      <div class="text-center py-8">
        <div class="text-red-500 text-lg mb-2">‚ö†Ô∏è Error</div>
        <p class="text-soft">{{ error() }}</p>
        <button 
          (click)="goBack()"
          class="mt-4 px-4 py-2 rounded-lg text-white bg-primary hover:bg-primary-700 transition-colors">
          Return to Servers
        </button>
      </div>
    </div>
  }

  <!-- Loading State -->
  @if (loading() || api.loading()) {
    <div class="server-detail-card">
      <div class="text-center py-8">
        <div class="text-soft text-lg mb-2">‚è≥ Loading Server Details...</div>
        <p class="text-soft">Please wait while we fetch your server information.</p>
      </div>
    </div>
  }

  <!-- Server Not Found -->
  @else if (!server() && !loading() && !error() && !api.loading()) {
    <div class="server-detail-card">
      <div class="text-center py-8">
        <div class="text-soft text-lg mb-2">üîç Server Not Found</div>
        <p class="text-soft">The requested server could not be found.</p>
        <button 
          (click)="goBack()"
          class="mt-4 px-4 py-2 rounded-lg text-white bg-primary hover:bg-primary-700 transition-colors">
          Return to Servers
        </button>
      </div>
    </div>
  }

  <!-- Server Details -->
  @if (server() && !loading()) {
    <div class="space-y-6">
      <!-- Consolidated Server Metrics Card -->
      <div class="server-detail-card">
        <div class="grid grid-cols-2 md:grid-cols-3 lg:grid-cols-6 gap-4">
          <!-- vCPU -->
          <div class="metric-item">
            <div class="metric-content">
              <div class="metric-icon">üñ•Ô∏è</div>
              <div class="metric-text">
                <div class="metric-value">{{ getCpuCount(server()!) }}</div>
                <div class="metric-label">vCPU</div>
              </div>
            </div>
          </div>
          
          <!-- RAM -->
          <div class="metric-item">
            <div class="metric-content">
              <div class="metric-icon">üíæ</div>
              <div class="metric-text">
                <div class="metric-value">{{ getRamSize(server()!) }}</div>
                <div class="metric-label">RAM</div>
              </div>
            </div>
          </div>
          
          <!-- Disk -->
          <div class="metric-item">
            <div class="metric-content">
              <div class="metric-icon">üíΩ</div>
              <div class="metric-text">
                <div class="metric-value">{{ getDiskSize(server()!) }}</div>
                <div class="metric-label">DISK LOCAL</div>
              </div>
            </div>
          </div>
          
          <!-- Usage (placeholder) -->
          <div class="metric-item">
            <div class="metric-content">
              <div class="metric-icon">üìä</div>
              <div class="metric-text">
                <div class="metric-value">‚Ç¨ 0.00</div>
                <div class="metric-label">USAGE</div>
              </div>
            </div>
          </div>
          
          <!-- Traffic (placeholder) -->
          <div class="metric-item">
            <div class="metric-content">
              <div class="metric-icon">üìà</div>
              <div class="metric-text">
                <div class="metric-value">0/20TB</div>
                <div class="metric-label">TRAFFIC OUT</div>
              </div>
            </div>
          </div>
          
          <!-- Price -->
          <div class="metric-item">
            <div class="metric-content">
              <div class="metric-icon">üí∞</div>
              <div class="metric-text">
                <div class="metric-value">{{ (server()!.priceEur || 0).toFixed(2) }} ‚Ç¨</div>
                <div class="metric-label">PRICE/MO</div>
              </div>
            </div>
          </div>
        </div>
      </div>

      <!-- Content Sections (Two Column Layout) -->
      <div class="grid grid-cols-1 lg:grid-cols-2 gap-6">
        
        <!-- Left Column: Server Activities (Full Height) -->
        <div class="lg:col-span-1">
          <div class="server-detail-card h-full">
            <h3 class="text-lg font-semibold text-ink mb-4 flex items-center gap-2">
              ‚ö° Server Activities
            </h3>
            <div class="space-y-3">
              <div class="activity-item">
                <div class="activity-left">
                  <div class="activity-icon">üü¢</div>
                  <div class="activity-title">Server created</div>
                </div>
                <div class="activity-time">{{ server()!.created ? getRelativeTime(server()!.created!) : 'Unknown' }}</div>
              </div>
              @if (server()!.status === 'running') {
                <div class="activity-item">
                  <div class="activity-left">
                    <div class="activity-icon">‚ñ∂Ô∏è</div>
                    <div class="activity-title">Server started</div>
                  </div>
                  <div class="activity-time">Recently</div>
                </div>
              }
            </div>
          </div>
        </div>

        <!-- Right Column: Server Options + Location (Stacked) -->
        <div class="lg:col-span-1 space-y-6">
          
          <!-- Server Options -->
          <div class="server-detail-card">
            <h3 class="text-lg font-semibold text-ink mb-4 flex items-center gap-2">
              ‚öôÔ∏è Server Options
            </h3>
            <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
              <div class="option-button-wrapper">
                <div class="option-icon">üíæ</div>
                <div class="option-button-content">
                  <button class="option-button-card" disabled>
                    <span class="option-action">Disable</span>
                  </button>
                  <div class="option-label">BACKUP</div>
                </div>
              </div>
              
              <div class="option-button-wrapper">
                <div class="option-icon">üì¶</div>
                <div class="option-button-content">
                  <button class="option-button-card" disabled>
                    <span class="option-action">Select group</span>
                  </button>
                  <div class="option-label">PLACEMENT GROUP</div>
                </div>
              </div>
              
              <div class="option-button-wrapper">
                <div class="option-icon">üåê</div>
                <div class="option-button-content">
                  <button class="option-button-card" disabled>
                    <span class="option-action">Disable</span>
                  </button>
                  <div class="option-label">PUBLIC NETWORK</div>
                </div>
              </div>
            </div>
          </div>

          <!-- Server Location -->
          <div class="server-detail-card">
            <h3 class="text-lg font-semibold text-ink mb-4 flex items-center gap-2">
              üìç Server Location
            </h3>
            <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
              <!-- Left: Location Details -->
              <div class="location-details">
                <div class="grid grid-cols-2 gap-4">
                  <!-- Column 1: DATACENTER & COUNTRY -->
                  <div class="space-y-4">
                    <div class="location-item">
                      <div class="location-label">DATACENTER</div>
                      <div class="location-value">{{ server()!.datacenter?.location?.name || server()!.location }}</div>
                    </div>
                    <div class="location-item">
                      <div class="location-label">COUNTRY</div>
                      <div class="location-value">
                        {{ getCountryFlag(server()!) }} {{ server()!.datacenter?.location?.country || server()!.country }}
                      </div>
                    </div>
                  </div>
                  
                  <!-- Column 2: CITY & NETWORK ZONE -->
                  <div class="space-y-4">
                    <div class="location-item">
                      <div class="location-label">CITY</div>
                      <div class="location-value">{{ getCleanCityName(server()!) }}</div>
                    </div>
                    <div class="location-item">
                      <div class="location-label">NETWORK ZONE</div>
                      <div class="location-value">eu-central</div>
                    </div>
                  </div>
                </div>
              </div>
              
              <!-- Right: Location Map (Full Height) -->
              <div class="location-map h-full">
                <div class="map-placeholder h-full">
                  <div class="map-point"></div>
                  üó∫Ô∏è Map View
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
  }
</section>